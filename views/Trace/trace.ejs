<!DOCTYPE html>
<html lang="en">

<head>
    <title>福娃糙米</title>
    <style type="text/css">
    	.trace {
    		width: 100%;
    		height: 700px;
    		/*float: left;*/
    		color: red;
    	}
    	.control {
    		padding: 10px;
    		border-bottom: 1px solid #e0e0e0;
    	}
    </style>
</head>
<body>
    <% include ../base.ejs %>
    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="page-header">食品溯源</h3>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-default">
                    <div class="trace">
                    	<div class="control">
							<form class="form-inline">
								<div class="form-group">
									<input type="text" value="" class="form-control" id="seed_num" placeholder="请输入种子编号">
								</div>
								<div class="form-group">
									<input type="text" value="" class="form-control" id="product_num" placeholder="请输入产品编号">
								</div>
								<button type="submit" class="btn btn-default" id="run_trace">开始溯源</button>
							</form>
                    	</div>
                    	<div class="map">

                    	</div>
                    </div>

                </div>
            </div>
        </div>
    </div>
<script type="text/javascript">
	function ajax(method, url, data, cb) {
		var xhr;
		if(window.XMLHttpRequest) {
			xhr = new XMLHttpRequest();
		}else {
			xhr = new ActiveXObject("Microsoft.XMLHTTP");
		}

		xhr.onreadystatechange = function() {
			if(xhr.readyState == 4 && xhr.status == 200) {
				console.log(xhr.responseText);
				cb(xhr.responseText);
			}
		}
		xhr.open(method, url);
		xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		var str = [];
		for(var key in data) {
			str.push(key + "=" + data[key]);
		}
		xhr.send(str.join("&"));
	}

	var product = document.querySelector("#product_num"),
		seed = document.querySelector("#seed_num"),
		trace = document.querySelector("#run_trace");

	trace.addEventListener('click', function(e) {
		e.preventDefault();
		ajax('post', '/trace/trace', {
			kind: seed.value != "" ? 'seed' : 'product',
			code: seed.value != "" ? seed.value : product.value
		}, function(data) {
			console.log(JSON.parse(data))
		})
	})


</script>
</body>
</html>